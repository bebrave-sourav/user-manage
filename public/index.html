<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>

  <style>
    #b1 {
      width: 120px;
      height: 40px;
      background-color: rgb(21, 21, 95);

      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;

      margin: auto;
    }

    #t1,
    #t2,
    #t3 {
      margin: 5px 5px 0px 5px;
      width: 95%;
    }

    table,
    td,
    th {
      padding: 10px;
      border: 2px solid black;
      border-radius: 5px;
      text-align: center;
    }

    #u,
    #d {
      height: 25px;
      width: 25px;
      padding: 0%;
    }
  </style>

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
    integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous" />
</head>

<body>
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" id="b1"
    onclick="readUsers()">
    Let's start
  </button>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="width: 700px;">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div style="float: left; width: 52%;">
            <table class="scrollbar scrollbar-success" id="ta" style="width: 95%;">

            </table>
          </div>
          <div style="float: left; width: 45%;">
            <div class="input-group">
              <div class="form-outline" style="width: 70%;">
                <!-- <label class="form-label" for="form1">Search</label> -->
                <input type="search" id="form1" class="form-control" placeholder="search user" style="height: 37px;" onkeypress="sugg()"
                  />
              </div>
              <div id="sugg" style="display: none;">

              </div>
              <but bvton type="button" class="btn btn-primary" style="height: 37px;width: 30%;" onclick="readUser()">
                <i class="fas fa-search"></i>
                </button>
            </div>
            <div style="
                  border: 1px solid black;
                  border-radius: 5px;
                  margin-top: 4px;
                ">
              <form>
                <input type="text" name="fname" class="form-control" id="t1" placeholder="enter first name" disabled>
                <br />
                <input type="text" name="lanme" class="form-control" id="t2" placeholder="enter last name" disabled>
                <br />
                <input type="email" name="email" class="form-control" id="t3" placeholder="enter email" required
                  disabled />
                <br />
                <button class="btn btn-success" id="b2"
                  style="margin-left: 37%;height: 20px;padding-top: 0%;padding-bottom: 5px; margin-bottom: 5px;"
                  disabled></button>
              </form>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Close
          </button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    var url;
    var selectedUserData = {};
    sugg = () => {
      alert('sugg');
      url = "http://localhost:5000/sugg?userstrng="+document.getElementById('form1').value;
      fetch(url, {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          table=document.createElement('table');
          sugg=document.getElementById("sugg");
          sugg.innerHTML = "";
          sugg.style.display = "block"; 
          for (let i = 0; i < data.result.length; i++) {
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.innerText = data.result[i].fname+" "+data.result[i].lname;
            td.onclick=()=>{
              document.getElementById('form1').value = td.innerText;
              selectedUserData['id']=data.result[i].id;
              selectedUserData['fname']=data.result[i].fname;
              selectedUserData['lname']=data.result[i].lname;
              selectedUserData['email']=data.result[i].email;
            }
            tr.appendChild(td);
            table.appendChild(tr);
          } 
          sugg.appendChild(table);
        }); 
      }
    
    check = () => {
      setTextBox();
      const operation = document.getElementById("b2").innerText;
      document.getElementById("t1").disabled = false;
      document.getElementById("t2").disabled = false;
      document.getElementById("t3").disabled = false;
      document.getElementById("b2").disabled = false;
      switch (operation) {
        case 'ADD': resetTextBox(); document.getElementById("b2").onclick = createUser; break;
        case 'UPDATE': document.getElementById("b2").onclick = updateUser; break;
        case 'DELETE': document.getElementById("b2").onclick = deleteUser;
      }

    };
    recheck = () => {
      document.getElementById("t1").disabled = true;
      document.getElementById("t2").disabled = true;
      document.getElementById("t3").disabled = true;
      document.getElementById("b2").disabled = true;
    };
    setTextBox = () => {
      document.getElementById("t1").value = selectedUserData.fname;
      document.getElementById("t2").value = selectedUserData.lname;
      document.getElementById("t3").value = selectedUserData.email;
    }
    resetTextBox = () => {
      document.getElementById("t1").value = "";
      document.getElementById("t2").value = "";
      document.getElementById("t3").value = "";
      selectedUserData = {};
    }
    createUser = () => {
      const form = document.forms[0];
      const inputs = form.querySelectorAll("input");
      //console.log(inputs[2].value);
      var userData = {
        fname: inputs[0].value,
        lname: inputs[1].value,
        email: inputs[2].value,
      };
      //const formData = new FormData(form);
      url = "http://localhost:5000/user";
      fetch(url, {
        method: "POST",
        headers: { "Content-type": "application/json ; charset=UTF-8" },
        body: JSON.stringify({ userData }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success == 1) {
            // document.getElementById("alert").classList.remove("d-none");
            resetTextBox();
            readUsers();
          }
        });
    };
    updateUser = () => {
      const form = document.forms[0];
      const inputs = form.querySelectorAll("input");
      var userData = {};
      var i = 0;
      for (let proprety in selectedUserData) {
        if (proprety == "id") {
          userData[proprety] = selectedUserData[proprety];
          continue;
        }
        if (inputs[i].value != selectedUserData[proprety]) {
          userData[proprety] = inputs[i].value;
        }
        i++;
      }
      url = "http://localhost:5000/user";
      fetch(url, {
        method: "PUT",
        headers: { "Content-type": "application/json ; charset=UTF-8" },
        body: JSON.stringify({ userData }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success == 1) {
            // document.getElementById("alert").classList.remove("d-none");
            resetTextBox();
            readUsers();
          }
        });
    };

    readUser = () => {
      url = "http://localhost:5000/user?userid=4";
      fetch(url, {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("t1").value = data.result[0].fname;
          document.getElementById("t2").value = data.result[0].lname;
          document.getElementById("t3").value = data.result[0].email;
          if (data.success == 1) {
            //document.getElementById("alert").classList.remove("d-none");
          }
        });
    };

    readUsers = () => {
      recheck();
      url = "http://localhost:5000/users";
      fetch(url, {
        method: "GET",
      })
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("ta").innerHTML = "";
          for (let i = 0; i < data.result.length; i++) {
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            const ul = document.createElement('ul');
            ul.style.listStyleType = "none";
            for (let j = 0; j < 2; j++) {
              const li = document.createElement('li');

              if (j == 0) {
                li.innerHTML = data.result[i].fname + " " + data.result[i].lname + "  <button class='btn btn-primary' value='" + JSON.stringify({ fname: data.result[i].fname, lname: data.result[i].lname, email: data.result[i].email, id: data.result[i].id }) + "' id='" + i + "u" + "' style='height: 25px;width: 25px;padding: 0%;'><i class='fas fa-pencil-alt'></i></button>  <button class='btn btn-danger' value='" + JSON.stringify({ fname: data.result[i].fname, lname: data.result[i].lname, email: data.result[i].email, id: data.result[i].id }) + "' id='" + i + "d" + "' style='height: 25px;width: 25px;padding: 0%;'><i class='fas fa-trash'></i></button>";

                ul.appendChild(li);

                continue;
              }
              li.innerHTML = data.result[i].email;
              ul.appendChild(li);
            }

            td.appendChild(ul);
            tr.appendChild(td);
            document.getElementById("ta").appendChild(tr);
            document.getElementById(i + 'u').onclick = () => {
              selectedUserData = JSON.parse(document.getElementById(i + 'u').value);
              document.getElementById('b2').innerText = 'UPDATE';
              check();
            }
            document.getElementById(i + 'd').onclick = () => {
              selectedUserData = JSON.parse(document.getElementById(i + 'd').value);
              //console.log(document.getElementById(i + 'd').value);
              document.getElementById('b2').innerText = 'DELETE';
              check();
            }
          }
          const tr = document.createElement('tr');
          const td = document.createElement('td');
          const button = document.createElement('button');
          button.classList.add('btn');
          button.classList.add('btn-success');
          button.innerHTML = "<i class='fas fa-user-plus'></i>";
          button.onclick = () => {
            document.getElementById('b2').innerText = 'ADD';
            check();
          };

          td.appendChild(button);
          tr.appendChild(td);
          document.getElementById("ta").appendChild(tr);
          if (data.success == 1) {

          }
        });
    };

    deleteUser = () => {
      alert("Are U sure to delete this user?");
      url = "http://localhost:5000/user?userid=" + selectedUserData.id;
      fetch(url, {
        method: "DELETE",
      }).then((response) => response.json())
        .then((data) => {
          if (data.success == 1) {
            // document.getElementById("alert").classList.remove("d-none");
            resetTextBox();
            readUsers();
          }
        });
    };

  </script>
</body>

</html>